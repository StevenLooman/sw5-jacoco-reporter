# Smallworld 5 JaCoCo reporter

[sw5-jacoco-reporter](https://github.com/StevenLooman/sw5-jacoco-reporter) is a tool to convert `jacoco.exec` generated by a Smallworld5 session to useful information for Magik development.


## Introduction

JaCoCo can generate can generate coverage reports, but those reports will contain internal classes, internal method names, and additionally generated classes which might be less interesting. This is due to the way Smallworld 5 generates Java Bytecode. While very valuable, reading these reports is a bit tedious.

It would be easier if the internal method names are converted to Magik method names, and possibly the additionally generated classes are removed/ignored.

This tool provides a means to convert back to the original Magik method names and optionally remove the additionally generated classes are removed/ignored.


## Compiling the Magik sources

To be able to determine which lines were hit during the tests, it is required to compile the modules. You can do this by calling the method `sw:sw_product.compile_all_modules()` of your product(s). This will result in a `libs/` directory contaning a jar for each module. E.g.,

```
Magik> prd_dir << "..."
Magik> system.rmdir(prd_dir + "/libs", _true, _true)  # Remove any existing `libs/` directory first!
...
Magik> prd << smallworld_product.add_product(prd_dir)
sw_product(...)
Magik> prd.compile_all_modules()
...
Magik> quit()
```

Stop the session and start a new session again. This is to ensure Smallworld uses the compiled code from the `libs/` directory instead of the results which were compiled in memory of the session. The results in memory of the session do not contain the line-data for each line of code.


## Usage

Options:

- `--help`
  - Show help.
- `--product-dir \[path_to_directory\]`
  - Path to your product.
- `--jacoco-file \[path_to_file\]`
  - Path to the `jacoco.exec` file.
- `--html \[path_to_directory\]`
  - Path to the directory to generate the HTML report in.
- `--xml \[path_to_file\]`
  - Path to the file to generate the XML at.
- `--filter-executable`
  - Filter executable classes, i.e., the class which does not hold any Magik methods.

To generate a HTML report:

```
$ java -jar sw5-jacoco-reporter.jar --product-dir ... --jacoco-file .../jacoco.exec --html .../coveragereport
```

To generate a XML report:

```
$ java -jar sw5-jacoco-reporter.jar --product-dir ... --jacoco-file .../jacoco.exec --xml .../coveragereport.xml
```


# Contributing

You can contribute by providing bug reports and/or pull requests via [GitHub](https://github.com/StevenLooman/sw5-jacoco-reporter).


# License

This tool is licensed under GPLv3.
